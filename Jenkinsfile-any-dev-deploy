pipeline  {
  agent any
  options {
    ansiColor('xterm')
  }
  parameters {
    string(name: 'COMPONENT', defaultValue: '', description: 'which component')
    string(name: 'ENV', defaultValue: '', description: 'Which environment')
    string(name: 'APP_VERSSION', defaultValue: '', description: 'Which app version')
    }

  environment {
    SSH = credentials("SSH")
    }

  stages {
    stage ('clone from repo') {
      steps {
        git branch: 'main', url: "https://github.com/devopsravi9/roboshop-ansible.git"
        sh " ls "
        }
      }
    stage ('Deploy') {
      steps{
        sh """
          ansible-playbook -i ${ENV}-inv.roboshop -e ROLE=${COMPONENT} -e HOST=${COMPONENT}-${ENV}.roboshop.internal  -e ansible_user=${SSH_USR} -e ansible_password=${SSH_PSW} roboshop.yml  -e ENV=${ENV} APP_VERSION=${APP_VERSSION}
        """
        }
      }
    }
  }